# tiy-java-gradle-template

This repository contains a template Spring Boot application using Gradle and Postgres. This application is configured in such a way that it can be easily deployed to Heroku.


## Usage

These instructions assume you've already created a Heroku account, installed the `heroku` command line application, and configured it correctly.  

1. Fork and/or clone this repository.  

2. In the cloned directory run `heroku create`. This will create a new application in Heroku and add a remote into your git configuration named "heroku".

3. Create a database and install the Heroku Postgres addon by running `heroku addons:create heroku-postgresql --app {app name}`. Replace `{app name}` with the name of your application in Heroku. For example, "enigmatic-escaprpment-12345".

  Alternatively, you can log into your Heroku account and select the application you wish to add the Postgres addon to. Under the Add-ons section of the web interface, search for Heroku Postgres - choose the free option and click "Provision". Heroku will create a Postgres database for you and set an environment variable that links the application to that database.

4. Run `git push heroku master` to deploy your application to Heroku.


## Development

This template has been configured to use a different configuration properties files when running in your local development environment vs. Heroku.

 * **application.properties** This file contains your development configuration. It assumes you're using a Postgres database named "example" running on your local host. You can easily setup Postgres for a Mac by [downloading and installing Postgres.app](http://postgresapp.com/). Run it, click on the elephant in your menu bar, open psql, and run `create database example`.

 * **application-heroku.properties** This file contains configuration for running the app on Heroku. It sets your database URL to the correct path for your Postgres database on Heroku's virtual machine. When you set up Postgres on Heroku, it will automatically save this location in the `JDBC_DATABASE_URL` environment variable.


## Logs

You can and should use `heroku logs -t` to "tail" (continuously watch) your logs when the application is starting. I like to keep two terminal windows open, one for general use, including `git push heroku master`, and one where I watch the Heroku log output. This is so much nicer than trying to use Heroku's online log viewer.


## build.gradle

This project is named "template" throughout. If you want to change the name of the jar file generated you can do this (but don't have to):

* Change `baseName = 'template'` to an appropriate name in the build.gradle file, under the "jar" block. This changes the name of the JAR file that will be generated by Gradle.
* Change the Procfile so that it uses the correct JAR file name now. By default it specifies `build/libs/template-0.0.1-SNAPSHOT.jar`. You'll want to change `template` to match what you set in the previous bullet point. Also, if you change your version numbers you'll want to update the JAR file's name accordingly.

You should be able to name your project's classes whatever you like.


## Procfile

The Procfile is an important part of any project that tells Heroku how to deploy your application to the web. When your push your code to Heroku, it will build a JAR file from your code, and the Procfile points to the location of that JAR file.

`web:    java -Dspring.profiles.active=heroku -Dserver.port=$PORT $JAVA_OPTS -jar build/libs/template-0.0.1-SNAPSHOT.jar`

* `web` tells Heroku that this is a web process.  

* `java` tells it to run your compiled code in the JVM.

* `-Dspring.profiles.active-heroku` selects your applications-heroku.properties file which points to the correct database location on the Heroku server.

* `-Dserver.port=$PORT` assigns port to the port specified in your $PORT environment variable.

* `$JAVA_OPTS` tells java to run with any options you have set in this environment variable (likely none)

* `-jar` tells java that this app has been compiled as a standalone JAR file rather than a class file

* `build/libs/template-0.0.1-SNAPSHOT.jar` is the path of the JAR file that was built when you pushed to Heroku. The full path depends on the name and version number you assigned to your app in the build.gradle file.

  If you are having trouble locating the JAR file after building, you can try `heroku run ls` at the command line to see your root path on the Heroku server. `heroku run ls build/` and so on will help you see individual directories.


## Running tests when building

By default your build process in Gradle attempts to run every test and will fail to compile if any of them fail. This can cause some issues on Heroku. If your tests pass locally and you are confident that the app is working correctly, you can bypass this by changing Heroku's default Gradle task.

At the command line, type `heroku config:set GRADLE_TASK="build -x test"` - this tells Heroku to run the usual build process when deploying with Gradle, but to skip the `test` process.


## Start your web process

Finally, in order to ensure that your app is running on the Heroku server, you will need to assign the "web" process you defined in your Procfile to a dyno. As a free user, you will only have one dyno. `heroku ps:scale web=1` will assign web to that one dyno.

Now visit your URL (projectname.herokuapp.com) and see your work on the web!
